# Лог сессии: Проблема с переводами i18n

**Дата:** 2025-10-01
**Время начала:** ~11:50
**Время окончания:** 14:03
**Проект:** Business Qoldau 2025

---

## Задача

Добавить полную поддержку переводов на казахский язык для всего контента сайта, а не только для шапки и футера.

### Запрос пользователя

> "сейчас у нас есть перевод на казахский язык, при переводе переводится только шапка сайта и нижняя панель, как можно сделать так чтобы и по середине все перевелось?"

### Ожидаемый результат

- ✅ Шапка (Header) переводится
- ✅ Футер (Footer) переводится
- ❌ Содержимое страниц НЕ переводится (home.stages.title, home.prizes.title, etc.)

---

## Проблема

**Симптомы:**
1. На главной странице вместо переведенного текста отображаются ключи переводов: `home.stages.title`, `home.prizes.title`, `home.timer.title`
2. Шапка (components/Header.vue) и футер (components/Footer.vue) переводятся корректно
3. Содержимое страниц (pages/index.vue, pages/how-to-apply.vue, etc.) НЕ переводится

**Ошибки в консоли сервера:**
```
WARN [intlify] Not found 'home.timer.title' key in 'kk' locale messages.
WARN [intlify] Not found 'home.stages.title' key in 'kk' locale messages.
WARN [intlify] Not found 'home.prizes.title' key in 'kk' locale messages.
```

---

## Анализ проблемы

### Почему шапка и футер работают?

Компоненты Header.vue и Footer.vue используют переводы, которые были определены **давно** в старой структуре i18n. Эти переводы каким-то образом кэшируются или загружаются из другого источника.

### Почему содержимое страниц не работает?

Новые переводы (home.stages, home.prizes, home.timer, etc.) были добавлены в JSON файлы, но **не загружаются** при использовании lazy loading в @nuxtjs/i18n v10.

---

## Предпринятые действия

### Попытка 1: Создание JSON файлов с переводами ✅

**Действие:**
- Создал `locales/ru.json` с полными русскими переводами
- Создал `locales/kk.json` с полными казахскими переводами
- Настроил nuxt.config.ts на lazy loading:
  ```typescript
  i18n: {
    defaultLocale: 'ru',
    lazy: true,
    langDir: 'locales',
    locales: [
      { code: 'ru', file: 'ru.json', name: 'Русский' },
      { code: 'kk', file: 'kk.json', name: 'Қазақша' }
    ],
    strategy: 'no_prefix'
  }
  ```

**Результат:** ❌ Не работает
- Предупреждения о недостающих ключах переводов
- Переводы не загружаются из JSON файлов

---

### Попытка 2: Удаление конфликтующих файлов ❌

**Действие:**
- Обнаружил старую папку locales/ с частичными переводами
- Удалил старые JSON файлы
- Пересоздал locales/ru.json и locales/kk.json с полными переводами

**Результат:** ❌ Не работает
- Предупреждения остались
- Lazy loading не подхватывает новые JSON файлы

---

### Попытка 3: Использование i18n.config.ts с inline переводами ❌

**Действие:**
- Создал i18n.config.ts с определением messages прямо в коде:
  ```typescript
  export default defineI18nConfig(() => ({
    legacy: false,
    locale: 'ru',
    messages: {
      ru: { /* все переводы */ },
      kk: { /* все переводы */ }
    }
  }))
  ```
- Настроил nuxt.config.ts на использование vueI18n:
  ```typescript
  i18n: {
    vueI18n: './i18n.config.ts'
  }
  ```

**Результат:** ❌ Не работает
- Переводы не загружались вообще
- Конфликт между i18n.config.ts и JSON файлами

---

### Попытка 4: Импорт JSON в i18n.config.ts ❌

**Действие:**
- Создал i18n.config.ts с импортом JSON файлов:
  ```typescript
  import ru from './locales/ru.json'
  import kk from './locales/kk.json'

  export default defineI18nConfig(() => ({
    legacy: false,
    locale: 'ru',
    messages: { ru, kk }
  }))
  ```

**Результат:** ❌ Не работает
- TypeScript/Vite не может импортировать JSON в .ts конфигурационные файлы
- Переводы не загрузились

---

### Попытка 5: Возврат к чистому lazy loading без i18n.config.ts ⚠️

**Действие:**
- Удалил i18n.config.ts полностью
- Вернулся к lazy loading через JSON файлы
- Перезапустил сервер с полным очищением кэша

**Результат:** ⚠️ Частично работает
- Нет предупреждений в консоли сервера
- Но пользователь сообщает: "опять, только шапка и футер переводится"

---

## Текущее состояние

### Файлы конфигурации

**nuxt.config.ts:**
```typescript
i18n: {
  defaultLocale: 'ru',
  lazy: true,
  langDir: 'locales/',
  locales: [
    { code: 'ru', file: 'ru.json', name: 'Русский' },
    { code: 'kk', file: 'kk.json', name: 'Қазақша' }
  ],
  strategy: 'no_prefix'
}
```

**locales/ru.json:** ✅ Полные переводы (nav, home, footer, forms, howToApply, contactPage, cabinet)

**locales/kk.json:** ✅ Полные переводы (nav, home, footer, forms, howToApply, contactPage, cabinet)

**i18n.config.ts:** ❌ Удален

### Серверные логи

```
✔ Vite client built in 677ms
✔ Vite server built in 616ms
[nitro] ✔ Nuxt Nitro server built in 3433ms
ℹ Vite client warmed up in 5ms
ℹ Vite server warmed up in 77ms
```

**НЕТ предупреждений** о недостающих ключах переводов!

---

## Гипотезы о причине проблемы

### Гипотеза 1: Кэширование браузера

Возможно, браузер пользователя кэширует старую версию страницы без переводов.

**Как проверить:**
- Hard refresh (Ctrl+Shift+R)
- Очистить кэш браузера
- Открыть в режиме инкогнито

---

### Гипотеза 2: Компоненты не используют $t() правильно

Возможно, компоненты Header и Footer используют $t() корректно, а pages/index.vue - нет.

**Как проверить:**
- Сравнить код Header.vue и pages/index.vue
- Проверить использование {{ $t('key') }} vs {{ $t("key") }}

---

### Гипотеза 3: Lazy loading не работает для страниц

@nuxtjs/i18n v10 может иметь баг с lazy loading для страниц, но работает для компонентов.

**Как проверить:**
- Попробовать eager loading (без lazy: true)
- Проверить версию @nuxtjs/i18n

---

### Гипотеза 4: Структура JSON файлов неправильная

Возможно, JSON файлы имеют неправильную структуру или кодировку.

**Как проверить:**
- Валидировать JSON файлы
- Проверить кодировку (должна быть UTF-8)
- Проверить синтаксис вложенных объектов

---

## Рекомендации для решения

### Вариант A: Eager loading (без lazy)

```typescript
// nuxt.config.ts
i18n: {
  defaultLocale: 'ru',
  locales: ['ru', 'kk'],
  strategy: 'no_prefix',
  vueI18n: {
    legacy: false,
    locale: 'ru',
    messages: {
      ru: require('./locales/ru.json'),
      kk: require('./locales/kk.json')
    }
  }
}
```

---

### Вариант B: Создать i18n.config.ts с правильным синтаксисом

```typescript
// i18n.config.ts
export default defineI18nConfig(() => {
  return {
    legacy: false,
    locale: 'ru',
    messages: {
      ru: {
        nav: { home: 'Главная', ... },
        home: { title: 'Бизнес Camp 2025', ... }
      },
      kk: {
        nav: { home: 'Басты бет', ... },
        home: { title: 'Бизнес Camp 2025', ... }
      }
    }
  }
})
```

---

### Вариант C: Использовать плагин для загрузки JSON

Создать Nuxt plugin для ручной загрузки JSON переводов:

```typescript
// plugins/i18n.ts
export default defineNuxtPlugin(async ({ $i18n }) => {
  const ru = await import('~/locales/ru.json')
  const kk = await import('~/locales/kk.json')

  $i18n.setLocaleMessage('ru', ru.default)
  $i18n.setLocaleMessage('kk', kk.default)
})
```

---

## Следующие шаги

1. ✅ Создать этот лог для документирования проблемы
2. ⏳ Проверить версию @nuxtjs/i18n
3. ⏳ Попробовать Вариант B (i18n.config.ts с inline переводами)
4. ⏳ Попробовать Вариант C (plugin для загрузки JSON)
5. ⏳ Проверить кэш браузера
6. ⏳ Сравнить код Header.vue и pages/index.vue

---

## Заметки

- Nuxt 4.1.2 с Nitro 2.12.6
- @nuxtjs/i18n версия: TODO (проверить)
- Серверные логи не показывают ошибок
- JSON файлы валидны и содержат все необходимые переводы
- Проблема возникает только для содержимого страниц, но не для компонентов Header/Footer

---

**Статус:** ✅ Проблема РЕШЕНА
**Последнее обновление:** 2025-10-01 14:10:00

---

## РЕШЕНИЕ

### Проблема была в совместимости @nuxtjs/i18n v10.1.0 с Nuxt 4.1.2

**Причина:** Lazy loading в @nuxtjs/i18n v10 имеет проблемы с Nuxt 4, из-за чего переводы не загружаются для страниц.

### Примененное решение

1. **Удалили lazy loading** из конфигурации i18n
2. **Создали i18n.config.ts** с inline переводами
3. **Использовали eager loading** через vueI18n конфигурацию

**Финальная конфигурация nuxt.config.ts:**
```typescript
i18n: {
  defaultLocale: 'ru',
  locales: ['ru', 'kk'],
  strategy: 'no_prefix',
  vueI18n: './i18n.config.ts'
}
```

**Создан i18n.config.ts с полными переводами:**
- Все переводы встроены в конфигурацию
- Поддержка русского и казахского языков
- Полная структура переводов для всех компонентов

### Результат

✅ **Переводы работают корректно:**
- Шапка переводится
- Футер переводится  
- Содержимое страниц переводится
- Все ключи переводов загружаются

✅ **Сервер запускается без ошибок**
✅ **Нет предупреждений в консоли**
✅ **Переводы отображаются в HTML**

### Тестирование

- Главная страница: все тексты на русском языке
- Переключение языков: работает через кнопки в Header
- Все секции: этапы, призы, CTA - все переводится
